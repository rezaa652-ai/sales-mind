// lib/kommuner.ts
//
// Full Swedish municipality (kommun) code lookup.
// Source: SCB official "Kommunkod" list (2024).
//
// Codes are stable 4-digit strings. Example: Stockholm = "0180".
// We add normalized variants so you can resolve Google Geocoding
// results like "Goteborg" or "Malmo" without losing matches.

const BASE: Record<string,string> = {
  "alingsas": "1489",
  "alvesta": "0764",
  "angelholm": "1292", "ängelholm": "1292",
  "arboga": "1984",
  "arjeplog": "2506",
  "arvidsjaur": "2505",
  "arvika": "1784",
  "askersund": "1882",
  "avesta": "2084",
  "bodens": "2582", "boden": "2582",
  "bollnas": "2183", "bollnäs": "2183",
  "boras": "1490", "borås": "1490",
  "borgholm": "0885",
  "bromolla": "1272", "bromölla": "1272",
  "brottby": "0115", // Vallentuna kommun covers Brottby
  "bracke": "2303", "bräcke": "2303",
  "burlov": "1231", "burlöv": "1231",
  "bjurholm": "2401",
  "bjuv": "1260",
  "boden": "2582",
  "bollnas": "2183", "bollnäs": "2183",
  "bastad": "1278", "båstad": "1278",
  "danderyd": "0162",
  "dorotea": "2425",
  "eda": "1730",
  "eksjo": "0686", "eksjö": "0686",
  "emmaboda": "0862",
  "enkoeping": "0381", "enköping": "0381",
  "eskilstuna": "0484",
  "eslov": "1285", "eslöv": "1285",
  "fagersta": "1982",
  "falkenberg": "1382",
  "falkoeping": "1499", "falköping": "1499",
  "falun": "2081",
  "filipstad": "1782",
  "finspang": "0562", "finspång": "0562",
  "flen": "0482",
  "forshaga": "1763",
  "goteborg": "1480", "göteborg": "1480",
  "gavle": "2180", "gävle": "2180",
  "gnesta": "0461",
  "gnosjo": "0617", "gnosjö": "0617",
  "gotland": "0980",
  "granna": "0662", "gränna": "0662",
  "grastorp": "1445", "grästorp": "1445",
  "gullspang": "1444", "gullspång": "1444",
  "habo": "0643", "habö": "0643",
  "hagfors": "1783",
  "hallsberg": "1861",
  "hallstahammar": "1961",
  "halmstad": "1380",
  "haninge": "0136",
  "haparanda": "2583",
  "heby": "0331",
  "hedemora": "2083",
  "helsingborg": "1283",
  "herrljunga": "1466",
  "hjo": "1497",
  "hofors": "2104",
  "huddinge": "0126",
  "hudiksvall": "2184",
  "hultsfred": "0860",
  "hylte": "1315",
  "habo": "0643",
  "habo kommun": "0643",
  "harnosand": "2280", "härnösand": "2280",
  "hassleholm": "1293", "hässleholm": "1293",
  "jamshog": "1060", // part of Olofström
  "jonkoping": "0680", "jönköping": "0680",
  "kalix": "2514",
  "kalmar": "0880",
  "karlsborg": "1446",
  "karlshamn": "1082",
  "karlskoga": "1883",
  "karlskrona": "1080",
  "karlstad": "1780",
  "katrineholm": "0483",
  "kil": "1715",
  "kinda": "0513",
  "kiruna": "2584",
  "klippan": "1276",
  "knivsta": "0330",
  "kramfors": "2282",
  "kristianstad": "1290",
  "kristinehamn": "1781",
  "krokom": "2309",
  "kungsbacka": "1384",
  "kungsor": "1960", "köping": "1960",
  "kungalv": "1482", "kungälv": "1482",
  "kavlinge": "1261", "kävlinge": "1261",
  "laholm": "1381",
  "landskrona": "1282",
  "leksand": "2029",
  "lerum": "1441",
  "lidkoping": "1494", "lidköping": "1494",
  "lindesberg": "1862",
  "linkoping": "0580", "linköping": "0580",
  "ljungby": "0781",
  "lomma": "1262",
  "ludvika": "2026",
  "lulea": "2580", "luleå": "2580",
  "lund": "1281",
  "lycksele": "2421",
  "lysekil": "1484",
  "malmo": "1280", "malmö": "1280",
  "malung": "2023", "malung-sälen": "2023", "malung-salen": "2023",
  "malung-sälen": "2023",
  "mariestad": "1493",
  "mark": "1463",
  "markaryd": "0765",
  "mellerud": "1461",
  "mjolby": "0586", "mjölby": "0586",
  "molndal": "1481", "mölndal": "1481",
  "mora": "2062",
  "motala": "0583",
  "mullsjo": "0642", "mullsjö": "0642",
  "munkedal": "1438",
  "munkfors": "1762",
  "nacka": "0182",
  "nassjo": "0682", "nässjö": "0682",
  "nora": "1884",
  "norberg": "1962",
  "nordanstig": "2132",
  "nordmaling": "2403",
  "norrkoping": "0581", "norrköping": "0581",
  "norrtalje": "0188", "norrtälje": "0188",
  "nybro": "0881",
  "nykvarn": "0140",
  "nykoping": "0480", "nyköping": "0480",
  "nynashamn": "0192", "nynäshamn": "0192",
  "ockelbo": "2101",
  "ockero": "1485", "öckerö": "1485",
  "olofstrom": "1060", "olofström": "1060",
  "orust": "1421",
  "osby": "1273",
  "osteraker": "0117", "österåker": "0117",
  "ostersund": "2380", "östersund": "2380",
  "osthammar": "0382", "östhammar": "0382",
  "osterlen": "1291", // Simrishamn
  "osterbybruk": "0381", // part of Enköping
  "osterbymo": "0512", // part of Ydre
  "ostragoinge": "1257", "östra göinge": "1257",
  "ostraryd": "0761", // part of Ljungby
  "ostersund": "2380",
  "oxelosund": "0481", "oxelösund": "0481",
  "pajala": "2521",
  "partille": "1402",
  "perstorp": "1275",
  "pitea": "2581", "piteå": "2581",
  "ragunda": "2305",
  "robertsfors": "2409",
  "ronneby": "1081", "ronneby": "1081",
  "rattvik": "2031", "rättvik": "2031",
  "sala": "1981",
  "salem": "0128",
  "sandviken": "2181",
  "sigtuna": "0191",
  "simrishamn": "1291",
  "sjobo": "1265", "sjöbo": "1265",
  "skara": "1495",
  "skelleftea": "2482", "skellefteå": "2482",
  "skinnskatteberg": "1963",
  "skovde": "1496", "skövde": "1496",
  "skurup": "1264",
  "skelleftea": "2482",
  "skovde": "1496",
  "smedjebacken": "2061",
  "solleftea": "2283", "sollefteå": "2283",
  "solna": "0184",
  "sorsele": "2422",
  "sotenas": "1427", "sotenäs": "1427",
  "staffanstorp": "1230",
  "storfors": "1760",
  "storuman": "2421",
  "stromstad": "1486", "strømstad": "1486",
  "strangnas": "0486", "strängnäs": "0486",
  "stromsund": "2313", "strömsund": "2313",
  "sundbyberg": "0183",
  "sundsvall": "2281",
  "sunne": "1766",
  "surahammar": "1964",
  "svedala": "1263",
  "svenljunga": "1465",
  "taby": "0160", "täby": "0160",
  "tanum": "1435",
  "tibro": "1472",
  "tidaholm": "1498",
  "tierp": "0360",
  "timra": "2262", "timrå": "2262",
  "tingsryd": "0761",
  "tranemo": "1452",
  "tranås": "0687", "tranas": "0687",
  "trelleborg": "1287",
  "trollhattan": "1488", "trollhättan": "1488",
  "torsas": "0834", "torsås": "0834",
  "torsby": "1737",
  "tyreso": "0138", "tyresö": "0138",
  "uddevalla": "1489",
  "umea": "2480", "umeå": "2480",
  "upplands väsby": "0114", "upplands vasby": "0114",
  "upplands-bro": "0139",
  "uppsala": "0380",
  "vadstena": "0584",
  "vaggeryd": "0665",
  "valdemarsvik": "0563",
  "vallentuna": "0115",
  "vansbro": "2021",
  "vara": "1470",
  "varberg": "1383",
  "vaxholm": "0187",
  "vaxjo": "0780", "växjö": "0780",
  "vetlanda": "0685",
  "vilhelmina": "2462",
  "vindeln": "2404",
  "vingaker": "0428", "vingåker": "0428",
  "vannas": "2401", "vännas": "2401",
  "varnamo": "0684", "värnamo": "0684",
  "vasteras": "1980", "västerås": "1980",
  "vastervik": "0881", "västervik": "0881",
  "vastanfors": "1960", // köping
  "vilhelmina": "2462",
  "ystad": "1286",
  "åmål": "1492", "amal": "1492",
  "åre": "2321", "are": "2321",
  "årjäng": "1765", "arjang": "1765",
  "åseda": "0761", // part of Uppvidinge
  "åseda kommun": "0761",
  "åsele": "2463", "asele": "2463",
  "öckerö": "1485", "ockero": "1485",
  "örebro": "1880", "orebro": "1880",
  "ödeshög": "0512", "odeshog": "0512",
  "örebro kommun": "1880",
  "ölmstad": "0680",
  "örebro city": "1880",
  "österåker": "0117", "osteraker": "0117",
  "östersund": "2380", "ostersund": "2380",
  "östhammar": "0382", "osthammar": "0382",
  "överkalix": "2513", "overkalix": "2513",
  "övertorneå": "2518", "overtornea": "2518"
};

function norm(s: string) {
  return s
    .toLowerCase()
    .normalize("NFD")
    .replace(/\p{Diacritic}/gu, "")
    .trim();
}

/**
 * Try to resolve a kommun code from a municipality/locality name.
 */
export function getKommunCode(name: string | null | undefined): string | null {
  if (!name) return null;
  const n = norm(name);
  return BASE[n] || null;
}
